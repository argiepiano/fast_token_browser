<?php

/**
 * @file
 * Token Browser Module
 */

/**
 * Implements hook_library().
 */
function token_browser_library() {
  $libraries['react'] = array(
    'title' => 'React',
    'version' => '16.x',
    'js' => array(
      'https://unpkg.com/react@16/umd/react.development.js' => array(),
      'https://unpkg.com/react-dom@16/umd/react-dom.development.js' => array(),
    ),
  );

  $libraries['velocity'] = array(
    'title' => 'Velocity.js',
    'version' => '2.x',
    'js' => array(
      drupal_get_path('module', 'token_browser') . '/dist/velocity.min.js' => array(),
    ),
  );

  $libraries['tree-grid'] = array(
    'title' => 'Tree Grid',
    'css' => array(
      drupal_get_path('module', 'token_browser') . '/css/tree-grid.css' => array(),
    ),
    'js' => array(
      drupal_get_path('module', 'token_browser') . '/dist/tree-grid.js' => array(),
    ),
    'dependencies' => array(
      array('token_browser', 'velocity'),
    ),
  );

  $libraries['token-browser'] = array(
    'title' => 'Token Browser',
    'js' => array(
      drupal_get_path('module', 'token_browser') . '/dist/token-browser.js' => array(),
    ),
    'dependencies' => array(
      array('system', 'ui.dialog'),
    ),
  );

  return $libraries;
}

/**
 * Implements hook_menu().
 */
function token_browser_menu() {
  // Test page with a test form on it.
  $items['token/browser/page'] = array(
    'title' => 'Token Browser Test Page',
    'page callback' => 'token_browser_page',
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
    'file' => 'includes/token_browser.callback.inc',
  );

  // AJAX callback for the assembled tree.
  $items['token/browser/tree'] = array(
    'page callback' => 'token_browser_tree',
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
    'file' => 'includes/token_browser.callback.inc',
    'theme callback' => 'ajax_base_page_theme',
  );

  // AJAX endpoint for retrieving a token.
  $items['token/browser/token'] = array(
    'page callback' => 'token_browser_endpoint',
    'delivery callback' => 'drupal_json_output',
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
    'file' => 'includes/token_browser.callback.inc',
  );

  // AJAX endpoint for retreiving token types.
  $items['token/browser/types'] = array(
    'page callback' => 'token_browser_types_endpoint',
    'delivery callback' => 'drupal_json_output',
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
    'file' => 'includes/token_browser.callback.inc',
  );

  return $items;
}

/**
 * Implements hook_theme().
 */
function token_browser_theme() {
  $themes['token_browser_link'] = array(
    'variables' => array(
      'text' => 'Token Browser',
    ),
    'file' => 'includes/token_browser.theme.inc',
  );

  $themes['tree_grid'] = array(
    'variables' => array(
      'header' => array(),
      'rows' => array(),
      'attributes' => array(),
    ),
    'file' => 'includes/token_browser.theme.inc',
  );

  return $themes;
}
